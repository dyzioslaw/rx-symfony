alter database symfony default character set utf8 collate utf8_general_ci;

/* TABELA PRODUKTÓW */
create table if not exists products
(
	`id_product`		int unsigned not null auto_increment primary key,
	`is_available`  	tinyint unsigned not null default 0,
	`name`				varchar(127) not null comment 'Product name',
	`description`		text null comment 'Product description',
	`exploitation_cost`	varchar(127) not null,
	`cover_image_path`	varchar(127) not null comment 'Product cover image path',
	`gallery_uri`		varchar(255) null,
	`movie_uri`			varchar(255) null,
	
	index 	   `fk_product_available` (`is_available`)
) engine = innodb default charset = utf8;

/* TABELA ATRYBUTÓW */
create table if not exists attributes
(
	`id_attribute`	int unsigned not null auto_increment primary key,
	`name`			varchar(127) not null comment 'Attribute name'
) engine = innodb default charset = utf8;

/* TABELA WARTOŚCI */
create table if not exists attribute_values
(
	`id_value`		int unsigned not null auto_increment primary key,
	`value`			varchar(255) not null
) engine = innodb default charset = utf8;

/* TABELA REALACJI: ATRYBUT + WARTOŚĆ */
create table if not exists attribute_relation
(
	`id_relation`		int unsigned not null auto_increment primary key,
	`id_attribute`		int unsigned not null,
	`id_value`			int unsigned not null,
	
	unique key `uniq_relation_data`	(`id_attribute`, `id_value`),
	foreign key (id_attribute) references attributes (id_attribute) on update cascade on delete cascade,
	foreign key (id_value) references attribute_values (id_value) on update cascade on delete cascade
) engine = innodb default charset = utf8;

/* TABELA RELACJI: PRODUKT + (ATRYBUT + WARTOŚĆ) */
create table if not exists products_combination
(
	`id_combination` int unsigned not null auto_increment primary key,
	`id_product`	 int unsigned not null,
	`id_relation`	 int unsigned not null,
	
	unique key `uniq_combination_data`	(`id_product`, `id_relation`),
	foreign key (id_product) references products (id_product) on update cascade on delete cascade,
	foreign key (id_relation) references attribute_relation (id_relation) on update cascade on delete cascade
) engine = innodb default charset = utf8;

/* DANE WEJŚCIOWE */
insert into `products` (id_product, is_available, name, exploitation_cost, cover_image_path, gallery_uri, movie_uri, description)
	values (1, 1, 'GOTA White / Black /Pink', 'zakup: 189 + 6 filtrów: 6x36 = 405 pln', 'upload/1/cover.jpg', 'http://www.airnaturel.pl/produkty/nawilzacze-powietrza/ultradzwiekowy-nawilzacz-powietrza-gota/', 'https://www.youtube.com/watch?v=dgUM330UO9M&feature=youtu.be', 'Produkt, który wyróżnia się wyglądem i funkcjonalnością. Atrakcyjny design sprawi, że Gota stanie się ciekawym elementem wystroju Twojego wnętrza. Jednocześnie zadba o odpowiedni poziom wilgotności w pomieszczeniach, w których przebywasz. Gota jest prostym w obsłudze nawilżaczem. Jednocześnie jest on kompaktowy i dyskretny. Można go umieścić w dowolnym miejscu w domu: na stoliku nocnym, na podłodze, na półce'),
		   (2, 1, 'CLEVAIR', 'upload/2/cover.jpg', 'zakup: 362 + 6 filtrów: 6x36 = 578 pln', 'http://www.airnaturel.pl/produkty/nawilzacze-powietrza/nowosc-ultradzwiekowy-nawilzacz-powietrza-z-jonizacja-i-ciepla-mgielka-clevair-40m%C2%B2/', NULL, 'W ty nawilżaczu skupiono kilka funkcji, które podnoszą jakość przetwarzanego powietrza oraz ułatwiają użytkowanie tego urządzenia. Nawilżacz Clevair wyposażony jest w elektroniczny wyświetlacz ułatwiający obsługę oraz higrostat pozwalający na automatyczną regulację wilgotności. Wyposażony jest także w jonizator, dzięki czemu nawilżone powietrze ma dodatkowo pozytywne właściwości dla naszego organizmu, oraz timer, który pozwala zarządzać czasem pracy urządzenia do 12 godzin. Obsługa tych funkcji możliwa jest także przy użyciu załączonego pilota. Ultradźwiękowe nawilżacze pracują na zasadzie łamania kropelek wody na tarczy ultradźwiękowej i generują mgiełkę. W przypadku nawilżacza Clevair generowana mgiełka może byc ciepła (nie ochładza pomieszczenia i częściowo jest sterylizowana) bądź zimna. Wytworzona para uwalniana jest przez ustawiany otwór 360*. Ten nawilżacz charakteryzuje się bardzo wysoką wydajnością i długością działania: pojemnik może pomieścić aż 5 litrów wody. Wystarczy to na około 15 godzin pracy przy maksymalnym wypływie pary (330 ml/h).'),
		   (3, 1, 'ORION', 'upload/3/cover.jpg', 'zakup: 399 + 6 maty: 6x75 = 849 pln', 'http://www.airnaturel.pl/produkty/nawilzacze-powietrza/orion-ekstremalnie-cichy-i-oszczedny-nawilzacz-ewaporacyjny-50m%C2%B2/', NULL, ''),
		   (4, 0, 'TAURUS', 'uploader/4/cover.jpg', 'zakup: 322 + 3 filtry: 3x75 = 547 pln', 'http://www.airnaturel.pl/produkty/nawilzacze-powietrza/parowy-nawilzacz-powietrza-taurus/', NULL, 'Nawilżacz ze specjalistycznym, sterylnym systemem nawilżania zapewniającym produkcję  pozbawionej bakterii i wirusów pary wodnej, oraz optymalny poziom nawilżenia powietrza, oraz możliwością stosowania aromaterapii.'), 
		   (5, 0, 'CARINA', 'upload/5/cover.jpg', 'zakup: 189 + 3 maty: 3x75 = 414 pln', 'http://www.airnaturel.pl/produkty/nawilzacze-powietrza/ewaporacyjny-nawilzacz-powietrza-carina/', NULL, '<strong>Carina marki Stylies</strong> to nawilżacz zaprojektowany z myślą przede wszystkim o pomieszczeniach takich jak sypialnie, pokoje dziecięce, pokoje dzienne – o powierzchni do 35 m². Technologia ewaporacji zastosowana w tym urządzenia pozwala na optymalne nawilżenie powietrza, dostosowane do Twoich potrzeb. Dzięki kasetom filtracyjnym i pracy wentylatora niemożliwe jest przewilgocenie powietrza. Carina jest przy tym urządzeniem cichym i energooszczędnym.'),
		   (6, 1, 'AQUILA', 'upload/6/cover.jpg', 'zakup: 235 + 3 filtry: 3x75 = 460 pln', 'http://www.airnaturel.pl/produkty/nawilzacze-powietrza/ultradzwiekowy-nawilzacz-powietrza-aquila/', NULL, '<strong>Ultradźwiękowy nawilżacz powietrza Aquila</strong> to nowoczesne urządzenie skupiające w sobie kilka funkcji, które podnoszą jakość przetwarzanego powietrza oraz ułatwiają użytkowanie. Aquila pracuje na zasadzie łamania kropelek wody na tarczy ultradźwiękowej i generuje tzw. zimną mgiełkę, której moc można w pełni kontrolować');
		   
insert into attributes (id_attribute, name)
	values (1, 'Powierzchnia'),
		   (2, 'Higrostat'),
		   (3, 'Jonizacja'),
		   (4, 'Ciepła mgiełka'),
		   (5, 'Aromaterapia'),
		   (6, 'Kolor'),
		   (7, 'Szerokość'),
		   (8, 'Wysokość'),
		   (9, 'Głębokość'),
		   (10, 'Moc'),
		   (11, 'Pojemność zbiornika'),
		   (12, 'Ilość stopni nawilżania'),
		   (13, 'Wydajność'),
		   (14, 'Maksymalny czas pracy'),
		   (15, 'Auto-stop przy pustym'),
		   (16, 'Głośność'),
		   (17, 'Lampka'),
		   (18, 'Gwarancja'),
		   (19, 'Filtr'),
		   (20, 'Opcje dodatkowe'),
		   (21, 'Na wyposażeniu'),
		   (22, 'Technologia');
		   
insert into attribute_values (id_value, value)
	values (1, 'Tak'),
		   (2, 'Nie'),
		   (3, '2 lata'),
		   (4, 'brak (można dodać)'),
		   (5, 'tak (w zestawie)'),
		   (6, 'tak (maty ewaporacyjne)'),
		   (7, 'pilot, timer'),
		   (8, 'częściowe oczyszczanie powietrza'),
		   (9, 'eliminacja bakterii i innych patogenów'),
		   (10, 'częściowe oczyszczanie powietrza, można dodać Ionic Silver Cube'),
		   (11, 'można dodać Ionic Silver Cube'),
		   (12, 'filtr, pilot'),
		   (13, 'maty ewaporacyjne'),
		   (14, 'brak'),
		   (15, 'filtr wody'),
		   (16, 'ultradżwiękowy'),
		   (17, 'ewaporacyjny'),
		   (18, 'parowy'),
		   (19, 'ewaporacyjny'),
		   (20, '30m2'),
		   (21, '40m2'),
		   (22, '50m2'),
		   (23, '70m2'),
		   (24, '35m2'),
		   (25, '25m2'),
		   (26, 'biały / czarny / malinowy'),
		   (27, 'biało-czarny'),
		   (28, 'biały'),
		   (29, '220'),
		   (30, '250'),
		   (31, '370'),
		   (32, '397'),
		   (33, '350'),
		   (34, '233'),
		   (35, '293'),
		   (36, '255'),
		   (37, '246'),
		   (38, '347'),
		   (39, '235'),
		   (40, '190'),
		   (41, '119'),
		   (42, '30'),
		   (43, '30-110'),
		   (44, '6-18 W'),
		   (45, '480W'),
		   (46, '8W'),
		   (47, '18W'),
		   (48, '3'),
		   (49, '5'),
		   (50, '6'),
		   (51, '7'),
		   (52, '3,5'),
		   (53, '2,2'),
		   (54, 'płynne w 18 stopnia'),
		   (55, '2'),
		   (56, 'płynna'),
		   (57, '1'),
		   (58, '300 ml/h'),
		   (59, '350 ml/h'),
		   (60, '500 ml/h'),
		   (61, '160'),
		   (62, '10 h'),
		   (63, '15 h'),
		   (64, '17 h'),
		   (65, '14'),
		   (66, '7'),
		   (67, '30'),
		   (68, '38'),
		   (69, '22'),
		   (70, '<35'),
		   (71, '<32'),
		   (72, '<33'),
		   (73, '390'),
		   (74, '36'),
		   (75, '236'),
		   (76, '330 ml/h'),
		   (77, 'częściowe oczyszczanie powietrza, można dodać Ionic Silver Cube');
		   
		   
insert into attribute_relation (id_attribute, id_value)
	values (22, 16),
		   (22, 19),
		   (22, 18),
		   (1,  20),
		   (1, 21),
		   (1, 22),
		   (1, 23),
		   (1, 24),
		   (1, 25),
		   (2, 1),
		   (2, 2),
		   (3, 1),
		   (3, 2),
		   (4, 1),
		   (4, 2),
		   (5, 1),
		   (5, 2),
		   (6, 26),
		   (6, 27),
		   (6, 28),
		   (7, 29),
		   (7, 30),
		   (7, 31),
		   (7, 32),
		   (7, 33),
		   (7, 34),
		   (8, 30),
		   (8, 35),
		   (8, 36),
		   (8, 37),
		   (9, 29),
		   (9, 38),
		   (9, 30),
		   (9, 39),
		   (9, 40),
		   (9, 41),
		   (10, 42),
		   (10, 43),
		   (10, 44),
		   (10, 45),
		   (10, 46),
		   (10, 47),
		   (11, 48),
		   (11, 49),
		   (11, 50),
		   (11, 51),
		   (11, 52),
		   (11, 53),
		   (12, 54),
		   (12, 48),
		   (12, 55),
		   (12, 56),
		   (12, 57),
		   (13, 58),
		   (13, 59),
		   (13, 60),
		   (13, 30),
		   (13, 61),
		   (14, 62),
		   (14, 63),
		   (14, 64),
		   (14, 65),
		   (14, 66),
		   (15, 1),
		   (15, 2),
		   (16, 67),
		   (16, 68),
		   (16, 69),
		   (16, 70),
		   (16, 71),
		   (16, 72),
		   (17, 1),
		   (17, 2),
		   (18, 3),
		   (19, 4),
		   (19, 5),
		   (19, 6),
		   (20, 2),
		   (20, 7),
		   (20, 8),
		   (20, 9),
		   (20, 11),
		   (8, 73),
		   (16, 74),
		   (8, 75),
		   (13, 76),
		   (22, 77);
		   
		   
insert into products_combination (id_product, id_relation)
	values (1, 1),
		   (1, 4),
		   (1, 11),
		   (1, 13),
		   (1, 15),
		   (1, 17),
		   (1, 18),
		   (1, 21),
		   (1, 83),
		   (1, 31),
		   (1, 37),
		   (1, 43),
		   (1, 49),
		   (1, 54),
		   (1, 59),
		   (1, 64),
		   (1, 84),
		   (1, 73),
		   (1, 74),
		   (1, 75),
		   (1, 78),
		   (2, 1),
		   (2, 5),
		   (2, 11),
		   (2, 13),
		   (2, 15),
		   (2, 17),
		   (2, 20),
		   (2, 22),
		   (2, 85),
		   (2, 32),
		   (2, 38),
		   (2, 44),
		   (2, 50),
		   (2, 86),
		   (2, 60),
		   (2, 64),
		   (2, 67),
		   (2, 73),
		   (2, 74),
		   (2, 76),
		   (2, 79),
		   (3, 2),
		   (3, 6),
		   (3, 10),
		   (3, 13),
		   (3, 15),
		   (3, 16),
		   (3, 20),
		   (3, 23),
		   (3, 27),
		   (3, 33),
		   (3, 39),
		   (3, 45),
		   (3, 51),
		   (3, 55),
		   (3, 61),
		   (3, 64),
		   (3, 68),
		   (3, 73),
		   (3, 74),
		   (3, 77),
		   (3, 80),
		   (4, 3),
		   (4, 7),
		   (4, 10),
		   (4, 13),
		   (4, 14),
		   (4, 16),
		   (4, 20),
		   (4, 24),
		   (4, 28),
		   (4, 34),
		   (4, 40),
		   (4, 46),
		   (4, 52),
		   (4, 56),
		   (4, 62),
		   (4, 64),
		   (4, 69),
		   (4, 73),
		   (4, 74),
		   (4, 75),
		   (4, 81),
		   (5, 2),
		   (5, 8),
		   (5, 11),
		   (5, 13),
		   (5, 15),
		   (5, 17),
		   (5, 20),
		   (5, 25),
		   (5, 29),
		   (5, 35),
		   (5, 41),
		   (5, 47),
		   (5, 53),
		   (5, 57),
		   (5, 63),
		   (5, 64),
		   (5, 70),
		   (5, 73),
		   (5, 74),
		   (5, 77),
		   (5, 87);
		   
		   
		 
		 
		   
# helper, do pobrania relacji :)

SELECT * FROM `attribute_relation` WHERE `id_attribute` = (Select id_attribute from attributes where name like '%opcje dodatkowe%')
and id_value = (select id_value from attribute_values where value = 'częściowe oczyszczanie powietrza, można dodać Ionic Silver Cube')

